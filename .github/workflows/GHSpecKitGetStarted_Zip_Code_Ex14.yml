name: CreateGHSpecKitEx14Zip
on:
  workflow_dispatch:
  push:
    branches:
      - 'main'
    paths:
      - DownloadableCodeProjects/standalone-lab-projects/sdd-get-started-rss-feed/**

defaults:
  run:
    shell: bash

jobs:
  create_zip:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Create GHSpecKitEx14 Stakeholder Documents zip
      run: | 
        # Ensure Downloads directory exists
        mkdir -p ./DownloadableCodeProjects/Downloads
        
        # Change to source directory
        cd ./DownloadableCodeProjects/standalone-lab-projects/sdd-get-started-rss-feed
        
        # Check if there are any git-tracked files to zip
        if [ -z "$(git ls-files)" ]; then
          echo "No git-tracked files found in the source directory"
          exit 1
        fi
        
        # Remove existing zip file and create new one
        rm -f ../../Downloads/GHSpecKitEx14StakeholderDocuments.zip
        zip -r -q ../../Downloads/GHSpecKitEx14StakeholderDocuments.zip $(git ls-files)

        # Verify zip file was created
        if [ ! -f ../../Downloads/GHSpecKitEx14StakeholderDocuments.zip ]; then
          echo "Failed to create zip file"
          exit 1
        fi

        echo "Successfully created GHSpecKitEx14StakeholderDocuments.zip"
    - name: Commit and push
      uses: Endbug/add-and-commit@v7
      with:
        add: '["DownloadableCodeProjects/Downloads/GHSpecKitEx14StakeholderDocuments.zip"]'
        message: 'Updating Zip with sample app source files'
        push: true
